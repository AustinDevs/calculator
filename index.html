<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Payment Plan Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body>
    <main class="container pt-5">
      <h1>Payment Plan Calculator Embed</h1>
      <div class="row mt-5 mb-3">
        <div class="col-lg-9">
          <div class="row">
            <div class="mb-3 col-sm-12 col-md-8 col-lg-8">
              <div class="text-center">
                <label for="start_date_range[0]" class="form-label">Start Date Range</label>
              </div>
              <div class="d-flex">
                <input type="date" class="form-control" id="start_date_range[0]" value="2023-05-30">
                <span>&nbsp;&nbsp;-&nbsp;&nbsp;</span>
                <input type="date" class="form-control" id="start_date_range[1]" value="2023-05-30">
              </div>
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="final_date" class="form-label">Final Date</label>
              <input type="date" class="form-control" id="final_date" value="2023-08-30">
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="down_payment_type" class="form-label">Down Payment Type</label>
              <select class="form-select" id="down_payment_type">
                <option selected value="Fixed">Fixed</option>
                <option value="Not Required">Not Required</option>
                <option value="Minimum">Minimum</option>
              </select>
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="down_payment_amount" class="form-label">Down Payment</label>
              <input type="number" step="0.01" class="form-control" id="down_payment_amount" value="1000.00">
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="down_payment_calc" class="form-label">Down Payment Calculation</label>
              <select class="form-select" id="down_payment_calc">
                <option selected value="amount">Amount</option>
                <option value="percent">Percent</option>
              </select>
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="total" class="form-label">Total (w/o fees)</label>
              <input type="number" step="0.01" class="form-control" id="total" value="3000.00">
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="fee" class="form-label">Fee</label>
              <input type="number" step="0.01" class="form-control" id="fee" value="200.00">
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="fee_calc" class="form-label">Fee Calculation</label>
              <select class="form-select" id="fee_calc">
                <option selected value="amount">Amount</option>
                <option value="percent">Percent</option>
              </select>
            </div>
            <div class="mb-3 col-sm-6 col-md-4 col-lg-4">
              <label for="primary_color" class="form-label">Primary Color</label>
              <input type="color" value="#3273dc" id="primary_color">
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-3">
          <label for="frequency" class="form-label">Payment Frequency (multi)</label>
          <select class="form-select" multiple id="frequency" size="6" required>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="2weekly" selected>Bi-weekly</option>
            <option value="monthly">Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
      </div>
      <code class="my-5"><pre id="embed-code" class="bg-light p-3 rounded"></pre></code>
      <iframe id="paycove-iframe" src="" scrolling="no" style="width: 1px; min-width: 100%; border: 0; overflow: hidden;"></iframe>
      <script src="https://paycove.io/js/embed.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.11.2/qs.min.js" integrity="sha512-vCegEXqPUYpZsTGz2lk0jaQ1psxtFeniVJACAXhMVxuoYa/N4nZkjoVFOxLwP7uGeQOoemiz7DQrIpRTj4IBPw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" referrerpolicy="no-referrer"></script>
      <script>
        new Paycove('#paycove-iframe', {
          onMessage: ({ message }) => document.querySelector('#output').innerText = JSON.stringify(message.payments, null, 2)
        });
        const handler = () => {
          const obj = { start_date_range: [], frequency: []};
          [...document.querySelectorAll('input, select')].forEach(el => {
            el.id === 'frequency' && (obj.frequency = Array.from(document.querySelectorAll('#frequency option:checked')).map(el => el.value))
            el.id === 'start_date_range[0]' && (obj.start_date_range[0] = el.value);
            el.id === 'start_date_range[1]' && (obj.start_date_range[1] = el.value);
            el.id === 'primary_color' && (obj.primary_color = encodeURIComponent(el.value));
            !['start_date_range[0]', 'start_date_range[1]', 'frequency', 'primary_color'].includes(el.id) && (obj[el.id] = el.value);
          })
          const iframeSrc = `https://staging.paycove.io/payment-scheduler?${Qs.stringify(obj, { arrayFormat: 'brackets', encode: false })}`;
          document.querySelector('#paycove-iframe').src = iframeSrc;
          document.querySelector('#embed-code').innerHTML = `&lt;iframe id=&quot;paycove-iframe&quot; src=&quot;${iframeSrc}&quot; scrolling=&quot;no&quot; style=&quot;width: 1px; min-width: 100%; border: 0; overflow: hidden;&quot;&gt;&lt;/iframe&gt;
&lt;script src=&quot;https://staging.paycove.io/js/embed.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  new Paycove('#paycove-iframe', {
    onMessage: ({ message }) =&gt; console.log(message)
  });
&lt;/script&gt;`;
        };
        const debouncedHandler = _.debounce(handler, 1000);
        [...document.querySelectorAll('input:not(#primary_color), select')].forEach(el => el.addEventListener('change', debouncedHandler))
        document.querySelector('#primary_color').addEventListener('input', debouncedHandler);
        handler()
      </script>
      <code class="my-5 text-success"><pre id="output" class="bg-light p-3 rounded"></pre></code>
    </main>
  </body>
</html>