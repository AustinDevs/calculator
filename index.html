<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Payment Plan Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body>
    <main class="container pt-5">
      <h1>Payment Plan Calculator Embed</h1>
      <div class="row my-5">
        <div class="mb-3 col-lg-2">
          <label for="start_date_range" class="form-label">Start Date</label>
          <input type="date" class="form-control" id="start_date_range" value="2023-05-30">
        </div>
        <div class="mb-3 col-lg-2">
          <label for="final_date" class="form-label">Final Date</label>
          <input type="date" class="form-control" id="final_date" value="2023-08-30">
        </div>
        <div class="mb-3 col-lg-2">
          <label for="down_payment_amount" class="form-label">Down Payment</label>
          <input type="number" step="0.01" class="form-control" id="down_payment_amount" value="1000.00">
        </div>
        <div class="mb-3 col-lg-2">
          <label for="total" class="form-label">Total (w/o fees)</label>
          <input type="number" step="0.01" class="form-control" id="total" value="3000.00">
        </div>
        <div class="mb-3 col-lg-2">
          <label for="fee" class="form-label">Fees</label>
          <input type="number" step="0.01" class="form-control" id="fee" value="200.00">
        </div>
      </div>
      </div>
      <code class="my-5"><pre id="embed-code" class="bg-light p-3 rounded"></pre></code>
      <iframe id="paycove-iframe" src="https://staging.paycove.io/payment-scheduler?start_date_range[]=2023-05-22&start_date_range[]=2100-01-01&final_date=2023-08-15&total=4290&frequency[]=monthly&frequency[]=2weekly&frequency[]=weekly&down_payment_amount=500&fee=300.04&down_payment_type=Fixed" style="width: 1px; min-width: 100%; border: 0"></iframe>
      <script src="https://staging.paycove.io/js/embed.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.11.2/qs.min.js" integrity="sha512-vCegEXqPUYpZsTGz2lk0jaQ1psxtFeniVJACAXhMVxuoYa/N4nZkjoVFOxLwP7uGeQOoemiz7DQrIpRTj4IBPw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
      <script>
        new Paycove('#paycove-iframe', {
          onMessage: ({ message }) => document.querySelector('#output').innerText = JSON.stringify(message.payments, null, 2)
        });
        const handler = () => {
          const obj = {};
          [...document.querySelectorAll('input')].forEach(el => {
            obj[el.id] = el.id === 'start_date_range' ? [el.value, el.value] : el.value
          })
          const iframeSrc = `https://staging.paycove.io/payment-scheduler?${Qs.stringify(obj, { arrayFormat: 'brackets', encode: false })}&down_payment_type=Fixed&frequency[]=monthly&frequency[]=2weekly&frequency[]=weekly`;
          document.querySelector('#paycove-iframe').src = iframeSrc;
          document.querySelector('#embed-code').innerHTML = `&lt;iframe id=&quot;paycove-iframe&quot; src=&quot;${iframeSrc}&quot; style=&quot;width: 1px; min-width: 100%; border: 0&quot;&gt;&lt;/iframe&gt;
&lt;script src=&quot;https://staging.paycove.io/js/embed.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  new Paycove('#paycove-iframe', {
    onMessage: ({ message }) =&gt; console.log(message)
  });
&lt;/script&gt;`;
        };
        [...document.querySelectorAll('input')].forEach(el => el.addEventListener('change', handler))
        handler()
      </script>
      <code class="my-5 text-success"><pre id="output" class="bg-light p-3 rounded"></pre></code>
    </main>
  </body>
</html>